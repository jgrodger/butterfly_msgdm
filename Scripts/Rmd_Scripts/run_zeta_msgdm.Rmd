---
title: "R Notebook"
output: html_notebook
---
 

# this will call the markdown(s) and generate report(s) with desired parameters

## setup
```{r}

here::i_am("Scripts/Rmd_Scripts/run_zeta_msgdm.Rmd")

library(tidyverse)
library(zetadiv)
# library(mgcv)
# library(caret)
# library(dismo)

library(rmarkdown)

library(tictoc)

library(here)

library(conflicted)

conflicts_prefer(dplyr::select)
```


##  Load functions
```{r}
source(here("./Scripts/R_scripts/get_k_fold_performance.R"))

source(here("./Scripts/R_scripts/Zeta.order.mc.sam.R"))

source(here("./Scripts/R_scripts/get_validation_different_seeds_and_samps.R"))
```



## Examine zeta decline whole dataset


# need to work out how to run the following, see https://bookdown.org/yihui/rmarkdown/params-knit.html#knit-with-custom-parameters

```{r}

# 
# render_report = function(dataset, analysis_script, sam_ddecay, sam_msgdm,  normalize_msgdm) {
#   out_path <-  paste0(here("Output/Spatial/"), "/", dataset, "_" , normalize_msgdm)
#   if(!dir.exists(out_path)) dir.create(out_path)
#   rmarkdown::render(
#     analysis_script, params = list(
#       dataset = "all_species",
#       sam_ddecay = 100,
#       sam_msgdm = 100
#     ),
#     output_dir = out_path)
# }

render_report = function(dataset, analysis_script, sam_ddecay, sam_msgdm, orders_msgdm, normalize_msgdm) {
  out_path <- if (analysis_script == "Zeta_declines_decays_analyses.Rmd"){
                  paste0(here("Output/Spatial/"), "/", params$dataset, "_" , "declines_and_decays", "/")
              } else{
              paste0(here("Output/Spatial/"), "/", dataset, "_" , normalize_msgdm)
              }
  if(!dir.exists(out_path)) dir.create(out_path)
  rmarkdown::render(analysis_script,
                    output_dir = out_path)
}

render_report(dataset = "all_species", analysis_script = "Zeta_declines_decays_analyses.Rmd", sam_ddecay = 10000, normalize_msgdm = FALSE)

render_report(dataset = "all_species", analysis_script = "Zeta_msgdm_analyses.Rmd",  
              orders_msgdm =  c(2,3), sam_msgdm = 50000, normalize_msgdm = "Sorensen")

render_report(dataset = "all_species", analysis_script = "Zeta_msgdm_analyses.Rmd",  
              orders_msgdm =  c(2,3), sam_msgdm = 50000, normalize_msgdm = "Simpson")

```


# Do this for WC and HS, note these need to now be saved from Process_CSV_data
```{r}
getwd()

```

