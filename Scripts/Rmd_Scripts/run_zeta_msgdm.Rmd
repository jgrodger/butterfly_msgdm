---
title: "Render Analysis Reports"
output: html_notebook
---
 

# this calls the markdowns and generate reports with specified parameters

## setup
```{r}

here::i_am("Scripts/Rmd_Scripts/run_zeta_msgdm.Rmd")

library(tidyverse)

library(zetadiv)

library(rmarkdown)

library(tictoc)

library(here)

library(conflicted)

conflicts_prefer(dplyr::select)
```


##  Load functions
```{r}

# performance: possibly do this in a different script
source(here("./Scripts/R_scripts/get_k_fold_performance.R"))

source(here("./Scripts/R_scripts/Zeta.order.mc.sam.R"))

source(here("./Scripts/R_scripts/get_validation_different_seeds_and_samps.R"))


# need to work out how to run the following, see # https://bookdown.org/yihui/rmarkdown/params-knit.html#knit-with-custom-parameters

render_report = function(analysis_script, params_list) {
  out_path <- if (analysis_script == "Zeta_declines_decays_analyses.Rmd"){
                  paste0(here("Output/Spatial/"), "/", params_list$dataset, "_" , "declines_and_decays", "/")
              } else{
              paste0(here("Output/Spatial/"), "/", params_list$dataset, "_" , params_list$normalize_msgdm)
              }
  if(!dir.exists(out_path)) dir.create(out_path)
  rmarkdown::render(input = analysis_script,
                    output_dir = out_path,
                    params = params_list)
}
```

## Zeta declines and decays
```{r}
render_report(analysis_script = "Zeta_declines_decays_analyses.Rmd", list(dataset = "all_species", sam_ddecay = 10000))
render_report(analysis_script = "Zeta_declines_decays_analyses.Rmd", list(dataset = "wc", sam_ddecay = 10000))
render_report(analysis_script = "Zeta_declines_decays_analyses.Rmd", list(dataset = "wc_no_zeros", sam_ddecay = 10000))
render_report(analysis_script = "Zeta_declines_decays_analyses.Rmd", list(dataset = "hs", sam_ddecay = 10000))
render_report(analysis_script = "Zeta_declines_decays_analyses.Rmd", list(dataset = "hs_no_zeros", sam_ddecay = 10000))
```
## GAMs

```{r}

#needs work

#need now to read chapter on GAMS to validated models
render_report(analysis_script = "GAM_analyses.Rmd", list(dataset = "all_species"))
```


## MSGDMs
```{r}
render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "all_species",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Sorensen"))

render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "all_species",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Simpson"))


render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "wc_no_zeros",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Sorensen"))

render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "wc_no_zeros",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Simpson"))


render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "hs_no_zeros",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Sorensen"))

render_report(analysis_script = "Zeta_msgdm_analyses.Rmd", list(dataset = "hs_no_zeros",  
              orders_msgdm =  c(2,3), sam_msgdm = 500, normalize_msgdm = "Simpson"))

```

