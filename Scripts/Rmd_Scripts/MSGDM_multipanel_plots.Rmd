---
title: "R Notebook"
output: html_notebook
---

```{r}
here::i_am("Scripts/Rmd_Scripts/Gamm_multipanel_fig.Rmd")
library(tidyverse)
library(ggpubr)
#library(mgcv)
#library(mgcViz)
library(here)
library(conflicted)

conflicts_prefer(dplyr::filter)
conflicts_prefer(dplyr::select)
```

# load gamm objects
```{r}


as_panels <- readRDS(here("./Output/Spatial/msgdms/all_species_Simpson_4//figs_tables//msgdm_single_splines.rds"))
wc_panels <- readRDS(here("./Output/Spatial/msgdms/wc_Simpson_4//figs_tables//msgdm_single_splines.rds"))
hs_panels <- readRDS(here("./Output/Spatial/msgdms/hs_Simpson_4//figs_tables//msgdm_single_splines.rds"))
```

## 2 chunks below copied from GAMM code
# prepare data from gam.plot to make a custom plot with geom_line()
```{r}
as_plot_data2 <- prepare.clfit(coef(as_gamm$gam)[1], as_plot_data)
wc_plot_data2 <- prepare.clfit(coef(wc_gamm$gam)[1], wc_plot_data)
hs_plot_data2 <- prepare.clfit(coef(hs_gamm$gam)[1], hs_plot_data)
```

#make custom plots of predicted values and CI from gam.plot
```{r}
# create 
p1a <- plot.clfit(as_plot_data2[[1]])
p4a <- plot.clfit(as_plot_data2[[2]])
p7a <- plot.clfit(as_plot_data2[[3]])
p10a <- plot.clfit(as_plot_data2[[4]])
p13a <- plot.clfit(as_plot_data2[[5]])
p16a <- plot.clfit(as_plot_data2[[6]])

p2a <- plot.clfit(wc_plot_data2[[1]])
p5a <- plot.clfit(wc_plot_data2[[2]])
p8a <- plot.clfit(wc_plot_data2[[3]])
p11a <- plot.clfit(wc_plot_data2[[4]])
p14a <- plot.clfit(wc_plot_data2[[5]])
p17a <- plot.clfit(wc_plot_data2[[6]])

p3a <- plot.clfit(hs_plot_data2[[1]])
p6a <- plot.clfit(hs_plot_data2[[2]])
p9a <- plot.clfit(hs_plot_data2[[3]])
p12a <- plot.clfit(hs_plot_data2[[4]])
p15a <- plot.clfit(hs_plot_data2[[5]])
p18a <- plot.clfit(hs_plot_data2[[6]])

#inspect
 gridPrint(p1a, p2a, p3a, 
          p4a, p5a, p6a,
          p7a, p8a, p9a,
          p10a, p11a, p12a,
          p13a, p14a, p15a,
          p16a, p17a, p18a,
          respect=TRUE,
          ncol = 3)

```



#### Extract coefficients for each zeta order
```{r}
# Extract coefficients for each zeta order into a list
all_coef <- list()
for(i in 1:length(my_orders)){
  temp_summary <- summary(my_msgdms[[i]]$model)
  
  # info needed to assign values below
  coef_rows <- nrow(temp_summary$coefficients)
  number_of_colours <- 1 + (nrow(temp_summary$coefficients) -1 )/3
  
  temp_coef <- rep(paste0("zeta_order", i), nrow(temp_summary$coefficients)) %>%
    data.frame() %>%
    rename(zeta_order = ".") %>%
    cbind(temp_summary$coefficients) %>%
    rename(p_value = "Pr(>|z|)",
      z_value = "z value",
      Std_Error = "Std. Error") %>% 
    rownames_to_column(var = "Effect")   %>% 
    mutate(Effect = factor(Effect, levels = Effect),
    zeta_order = paste0("zeta_", my_orders[i]),#adding zeta_order as a column
      Lower = Estimate - 1.96*Std_Error, #CL
      Upper = Estimate + 1.96*Std_Error,
      colours = factor(c(1, rep(2:number_of_colours, each = 3))),
      y_height = as.numeric(rev(seq(1,coef_rows))))
  # tried to add a row so this aligns with forest plot, will change text colour to white later
  #blank <- temp_coef[1,]
  #blank$Effect <- "blank"
  #temp_coef <- rbind(blank, temp_coef)
  
  
  all_coef[[i]] <- temp_coef
}



check<- bind_rows(all_coef)
```
