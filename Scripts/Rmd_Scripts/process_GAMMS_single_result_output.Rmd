---
title: ""
output: html_document

params:
  analysis: "gamm_cor_struct_compare_reduced_mod"
  dataset: "all_species"
  corStruct: "corExp"
---


```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```



```{r }
#### Packages
here::i_am("Scripts/Rmd_Scripts/process_GAMMS_single.Rmd")
library(tidyverse)
library(mgcv)
library(knitr)
library(knitrProgressBar)
library(tictoc)
library(here)
library(conflicted)
conflicts_prefer(dplyr::filter)
conflicts_prefer(dplyr::select)
conflicts_prefer(knitrProgressBar::progress_estimated)
# there is a same-named function in dplyr, check it out
```
#https://stackoverflow.com/questions/25824795/how-to-combine-two-rmarkdown-rmd-files-into-a-single-output

```{r}
#gamm output has been saved in output already

data_path <- here("Data/Processed_Data/Spatial//" )
gamm_path <-  here(paste0("Output/Spatial/GAM/GAMM_", params$dataset, "//"))
out_path <-  here(paste0("Output/Spatial/GAM/GAMM_", params$dataset, "/", params$analysis, "//"))
if(!dir.exists(out_path)) dir.create(out_path)
```


```{r}

#### Get the specified GAMM
gamm_cor_struct_list <- readRDS(paste0(gamm_path, params$analysis, ".rds"))
names(gamm_cor_struct_list) <- c("gamm_corGaus", "gamm_corExp", "gamm_corLin",
"gamm_corRatio", "gamm_corSpher")

#extract all the GAMMS
gamm_corGaus <- gamm_cor_struct_list[[1]]
gamm_corExp <- gamm_cor_struct_list[[2]]
gamm_corLin <- gamm_cor_struct_list[[3]]
gamm_corRatio <- gamm_cor_struct_list[[4]]
gamm_corSpher <- gamm_cor_struct_list[[5]]

#choose the one specified in params
# get() finds object with name specified as a character string
my_gamm <- get(paste0("gamm_", params$corStruct))

```




```{r}
#gtable and modelsummary packages may offer nice options but I haven't figured it out
#### Save gam summary to text file
#sink(paste0(out_path, "gam_summ.txt"))
print("Significance testing of smooth terms and other summary output for GAMM")
summary(my_gamm$gam)
#sink()
```


```{r , fig.show='hide'}
png(file = paste0(out_path, "gam_plot.png"))

par(mfrow = c(2, 3))
plot(my_gamm$gam, shade = TRUE, shift = coef(my_gamm$gam)[1])
dev.off()  
```

