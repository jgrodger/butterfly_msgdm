---
title: "Main text and supplementary Figures and Tables for Rodger et al. XXX"
output: html_document
date: "2024-04-24"
---

## https://stackoverflow.com/questions/25824795/how-to-combine-two-rmarkdown-rmd-files-into-a-single-output


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
here::i_am("Scripts/Rmd_Scripts/butterfly_msgdm_tables_figures_report.Rmd")

library(rmarkdown)
library(readr)
library(knitr)
library(knitrProgressBar)
library(tictoc)
library(gridExtra)
library(conflicted)
library(here)

conflicts_prefer(dplyr::filter)
conflicts_prefer(dplyr::rename)
```

#### Functions (consider moving to another script)

```{r}

#csv_path: file path for use in read_csv(here())
#tab_no
#tab_cap: caption argument for kable()
#my_dig: digits argument for kable()

print_csv <- function(csv_path, tab_no = "", tab_cap = "", my_dig = 3){
  
my_table <- read_csv(here(csv_path))

my_caption <- if(tab_cap == "") {
"" #Allow caption to be empty if so desired
} else {
paste0("Table ", tab_no, ".", tab_cap)
} 


kable(my_table, digits = my_dig,
      caption = my_caption)  
}

```


#### The datasets we are reporting on 
```{r}
datasets <- c("all_species", "wc", "hs", "hs_no_zeros")
dataset_names <- c("All Butterfly Species", "Wider Countryside Species", "Habitat Specialists including sites with no species", "Habitat Specialists excluding sites with no species" )
```


```{r include = FALSE }
# Resources for markdown
#https://epirhandbook.com/en/reports-with-r-markdown.html
#https://bookdown.org/yihui/rmarkdown/r-code.html#figures
#https://rmarkdown.rstudio.com/articles_report_from_r_script.html
#https://uoepsy.github.io/scs/rmd-bootcamp/06-figs.html
#http://zevross.com/blog/2017/06/19/tips-and-tricks-for-working-with-images-and-figures-in-r-markdown-documents/
# to use loop for figures, it may work in pander, although I resorted to generating the chunk code with a loop
#https://github.com/Rapporter/pander/blob/master/vignettes/pander.Rmd
#https://stackoverflow.com/questions/36373630/create-a-loop-that-includes-both-a-code-chunk-and-text
```

# Main

## Site density

```{r fig.cap = "Figure 1. Geographic distribution and density of the 1149 UKBMS transects used in this study", out.width = "100%"}
include_graphics(here("Output/Spatial/Figures/Hex_dens_transects.png/"))
```
## Environmental variables

```{r fig.cap = "Figure 2. Four Influential environmental variables for turnover and richness of butterflies in Great Britain", out.width = "100%"}
include_graphics(here("./Output/Spatial/Figures/fig_2_env_vars.png"))
```

## MSGDMS



# Supplemental Materials

## Occupancy


```{r , message=FALSE}
print_csv(tab_no = "S1",
          csv_path = "Output/Spatial/zeta_declines_decays/all_species/butterfly_occupancy.csv",
          tab_cap = "Occupancy of butterflies in the site used for this study")
```

#### GAMs and GAMMs
```{r , message=FALSE}
print_csv(tab_no = "SG1",
          csv_path = "Output/Spatial/GAM/GAM_all_species/family_aic_table.csv",
          tab_cap = "Comparison of GAM models for different distribution of species richness for All Species.",
          my_dig = 2)
```

```{r , message=FALSE}
print_csv(tab_no = "SG2",
          csv_path = "Output/Spatial/GAM/GAM_wc/family_aic_table.csv",
          tab_cap = "Comparison of GAM models for different distribution of species richness for Wider Countryside Species.",
          my_dig = 2)
```


```{r , message=FALSE}
print_csv(tab_no = "SG3",
          csv_path = "Output/Spatial/GAM/GAM_hs/family_aic_table.csv",
          tab_cap = "Comparison of GAM models for different distribution of species richness for Habitat Specialists.",
          my_dig = 2)
```

```{r include = FALSE}
# All Species
```


```{r , message=FALSE}
print_csv(tab_no = "SG4",
          csv_path = "Output/Spatial/GAM/GAMM_all_species/gamm_cor_struct_compare_reduced_mod/corExp/gamm_info.csv",
          tab_cap = "Key information for GAMM for All Species")

```

```{r , message=FALSE}
print_csv(tab_no = "SG5",
          csv_path = "Output/Spatial/GAM/GAMM_all_species/gamm_cor_struct_compare_reduced_mod/corExp/parametric_p_value_table.csv",
          tab_cap = "Significance of parametric and smooth terms in GAMM for All Species")

print_csv(csv_path = "Output/Spatial/GAM/GAMM_all_species/gamm_cor_struct_compare_reduced_mod/corExp/smooth_p_value_table.csv")
```

```{r include = FALSE}
# WCS
```

```{r , message=FALSE}
print_csv(tab_no = "SG4",
          csv_path = "Output/Spatial/GAM/GAMM_wc/gamm_cor_struct_compare_reduced_mod/corExp/gamm_info.csv",
          tab_cap = "Key information for GAMM for Wider Countryside Species")

```

```{r , message=FALSE}
print_csv(tab_no = "SG5",
          csv_path = "Output/Spatial/GAM/GAMM_wc/gamm_cor_struct_compare_reduced_mod/corExp/parametric_p_value_table.csv",
          tab_cap = "Significance of parametric and smooth terms in GAMM for Wider Counrysided Species")

print_csv(csv_path = "Output/Spatial/GAM/GAMM_wc/gamm_cor_struct_compare_reduced_mod/corExp/smooth_p_value_table.csv")
```

```{r}
# HS
```

```{r , message=FALSE}
print_csv(tab_no = "SG4",
          csv_path = "Output/Spatial/GAM/GAMM_hs/gamm_cor_struct_compare_reduced_mod/corExp/gamm_info.csv",
          tab_cap = "Key information for GAMM for Habitat Specialists")

```

```{r , message=FALSE}
print_csv(tab_no = "SG5",
          csv_path = "Output/Spatial/GAM/GAMM_hs/gamm_cor_struct_compare_reduced_mod/corExp/parametric_p_value_table.csv",
          tab_cap = "Significance of parametric and smooth terms in GAMM for Habitat Specialists")

print_csv(csv_path = "Output/Spatial/GAM/GAMM_hs/gamm_cor_struct_compare_reduced_mod/corExp/smooth_p_value_table.csv")
```


#### All Butterfly Species
```{r fig.cap = "Figure 3. Effects of environemental variables on speccies richness of All Species from GAMM analyses", out.width = "100%"}
include_graphics(here("Output/Spatial/GAM/GAMM_all_species/gamm_cor_struct_compare_reduced_mod/corExp/gam_plot.png"))
```

#### Wider Countryside Species
```{r fig.cap = "Figure 3. Effects of environemental variables on speccies richness of Wider Countryside Species from GAMM analyses", out.width = "100%"}
include_graphics(here("Output/Spatial/GAM/GAMM_wc/gamm_cor_struct_compare_reduced_mod/corExp/gam_plot.png"))
```

#### Habitat Specialists
```{r fig.cap = "Figure 3. Effects of environemental variables on speccies richness of Habitat Specialists from GAMM analyses", out.width = "100%"}
include_graphics(here("Output/Spatial/GAM/GAMM_hs/gamm_cor_struct_compare_reduced_mod/corExp/gam_plot.png"))
```





## Environmental variables

```{r fig.cap = "Figure S2. Four less influential environmental variables for turnover and richness of butterflies in Great Britain", out.width = "100%"}
include_graphics(here("./Output/Spatial/Figures/fig_supp_other_env_vars.png"))
```

## Zeta Declines

### Zeta orders 1 to 10
```{r include = FALSE}
# The code in the four chunks below is generated in a loop in generate_code_chunks_for_supp_report and manually copied and pasted here 
```

#### All Butterfly Species
```{r fig.cap = "Figure S3. Zeta diversity decline for All Butterfly Species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/all_species/all_species_zeta_decline_to_10.png"))
```

#### Wider Countryside Species
```{r fig.cap = "Figure S4. Zeta diversity decline for Wider Countryside Species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/wc/wc_zeta_decline_to_10.png"))
```

#### Habitat Specialists including sites with no species
```{r fig.cap = "Figure S5. Zeta diversity decline for Habitat Specialists including sites with no species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/hs/hs_zeta_decline_to_10.png"))
```

#### Habitat Specialists excluding sites with no species
```{r fig.cap = "Figure S6. Zeta diversity decline for Habitat Specialists excluding sites with no species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/hs_no_zeros/hs_no_zeros_zeta_decline_to_10.png"))
```

### Zeta orders 1 to 250
```{r include = FALSE}
# The code in the two chunks below is generated in a looop in generate_code_chunks_for_supp_report and manually copied and pasted here 
```

#### All Butterfly Species
```{r fig.cap = "Figure S7. Zeta diversity decline for All Butterfly Species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/all_species/all_species_zeta_decline_to_250.png"))
```

#### Wider Countryside Species
```{r fig.cap = "Figure S8. Zeta diversity decline for Wider Countryside Species, zeta orders 1 to 10", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/wc/wc_zeta_decline_to_250.png"))
```

## Comparison of exponential versus power Law fits to zeta decline
```{r, results='asis', message=FALSE}
for (i in 1:length(datasets)){
  my_file <- paste0("./Output/Spatial/zeta_declines_decays/", datasets[i], "/", 
                    datasets[i], "_zeta_declines_performance.csv")
  performance <-  read_csv(here(my_file))
  print(kable(performance, digits = 3,
             caption = paste0("Table S", i+1, ". Comparison of exponential versus power law fits to zeta decline for ", dataset_names[i])))
}
```

## Comparison of zeta decline values
```{r, results='asis', message=FALSE}

for (i in 1:length(datasets)){
my_file <- paste0("./Output/Spatial/zeta_declines_decays/", datasets[i], "/", datasets[i], "_zeta_decline_exact.csv")
zeta_div <-  read_csv(here(my_file))
print(kable(t(zeta_div), digits = 2,
             caption = paste0("Table S", i+5, ". Comparison of zeta diversity values for ", dataset_names[i])))
}
```

## Zeta decays

#### All Butterfly Species
```{r fig.cap = "Figure S9. Zeta diversity decay with distance for , zeta orders 1 to 100", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/all_species/all_species_zeta_distance_decays.png"))
```

#### Wider Countryside Species
```{r fig.cap = "Figure S10. Zeta diversity decay with distance for , zeta orders 1 to 100", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/wc/wc_zeta_distance_decays.png"))
```

#### Habitat Specialists including sites with no species
```{r fig.cap = "Figure S11. Zeta diversity decay with distance for , zeta orders 1 to 100", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/hs/hs_zeta_distance_decays.png"))
```

#### Habitat Specialists excluding sites with no species
```{r fig.cap = "Figure S12. Zeta diversity decay with distance for , zeta orders 1 to 100", out.width = "100%"}
include_graphics(here("./Output/Spatial/zeta_declines_decays/hs_no_zeros/hs_no_zeros_zeta_distance_decays.png"))
```

## MSGDMS

### Forest Plots

#### All Butterfly Species, Simpson
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Simpson/figs_tables/forest_plot.png"))
```
```{r fig.cap = "Figure S13. Effect sizes and p-values for splines of predictor variables and the intercept for All Butterfly Species, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Simpson/figs_tables/forest_plot_p_values.png"))
```

#### Wider Countryside Species, Simpson
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Simpson/figs_tables/forest_plot.png"))
```
```{r fig.cap = "Figure S14. Effect sizes and p-values for splines of predictor variables and the intercept for Wider Countryside Species, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Simpson/figs_tables/forest_plot_p_values.png"))
```

#### Habitat Specialists, Simpson
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Simpson/figs_tables/forest_plot.png"))
```
```{r fig.cap = "Figure S15. Effect sizes and p-values for splines of predictor variables and the intercept for Habitat Specialists, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Simpson/figs_tables/forest_plot_p_values.png"))
```

#### All Butterfly Species, Sorensen
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Sorensen/figs_tables/forest_plot.png"))
```
```{r fig.cap = "Figure S16. Effect sizes and p-values for splines of predictor variables and the intercept for All Butterfly Species, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Sorensen/figs_tables/forest_plot_p_values.png"))
```

#### Wider Countryside Species, Sorensen
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Sorensen/figs_tables/forest_plot.png"))
```
```{r fig.cap = "Figure S17. Effect sizes and p-values for splines of predictor variables and the intercept for Wider Countryside Species, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Sorensen/figs_tables/forest_plot_p_values.png"))
```

#### Habitat Specialists, Sorensen
```{r, out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Sorensen/figs_tables/forest_plot.png"))
```

```{r fig.cap = "Figure S18. Effect sizes and p-values for splines of predictor variables and the intercept for Habitat Specialists, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Sorensen/figs_tables/forest_plot_p_values.png"))
```


###Deviance explained

#### All Butterfly Species, Simpson
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/all_species_Simpson/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for All Butterfly Species, Simpson"))
```

```{r fig.cap = "Figure S19. Deviance partitioning in MSGDMS for All Butterfly Species, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Simpson/figs_tables/msgdm_var_pie.png"))
```

#### Wider Countryside Species, Simpson
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/wc_Simpson/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for Wider Countryside Species, Simpson"))
```

```{r fig.cap = "Figure S20. Deviance partitioning in MSGDMS for Wider Countryside Species, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Simpson/figs_tables/msgdm_var_pie.png"))
```

#### Habitat Specialists, Simpson
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/hs_no_zeros_Simpson/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for Habitat Specialists, Simpson"))
```

```{r fig.cap = "Figure S21. Deviance partitioning in MSGDMS for Habitat Specialists, Simpson", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Simpson/figs_tables/msgdm_var_pie.png"))
```

#### All Butterfly Species, Sorensen
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/all_species_Sorensen/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for All Butterfly Species, Sorensen"))
```

```{r fig.cap = "Figure S22. Deviance partitioning in MSGDMS for All Butterfly Species, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/all_species_Sorensen/figs_tables/msgdm_var_pie.png"))
```

#### Wider Countryside Species, Sorensen
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/wc_Sorensen/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for Wider Countryside Species, Sorensen"))
```

```{r fig.cap = "Figure S23. Deviance partitioning in MSGDMS for Wider Countryside Species, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/wc_Sorensen/figs_tables/msgdm_var_pie.png"))
```

#### Habitat Specialists, Sorensen
```{r, out.width = "100%"}
devtab <- read_csv(here("./Output/Spatial/msgdms/hs_no_zeros_Sorensen/figs_tables/deviance_table.csv"))
kable(devtab, digits = 3,
caption = paste0("Table S", i + 9, ". Deviance explained by MSGDMs for Habitat Specialists, Sorensen"))
```

```{r fig.cap = "Figure S24. Deviance partitioning in MSGDMS for Habitat Specialists, Sorensen", out.width = "100%"}
include_graphics(here("./Output/Spatial/msgdms/hs_no_zeros_Sorensen/figs_tables/msgdm_var_pie.png"))
```


